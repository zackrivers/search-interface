<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manifest - Search Results</title>
    <style>
        :root {
            /* Dark theme (default) */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --bg-tertiary: #374151;
            --bg-quaternary: #4b5563;
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --text-disabled: #6b7280;
            --border-primary: #374151;
            --border-secondary: #4b5563;
            --accent-blue: #3b82f6;
            --accent-blue-hover: #2563eb;
            --accent-green: #10b981;
            --accent-green-hover: #059669;
            --accent-red: #ef4444;
            --shadow-light: rgba(0, 0, 0, 0.3);
            --shadow-heavy: rgba(0, 0, 0, 0.5);
            --highlight-bg: rgba(59, 130, 246, 0.1);
            --highlight-border: rgba(59, 130, 246, 0.3);
            --theme-name: "Dark";
        }

        [data-theme="professional"] {
            /* Professional Blue theme */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-quaternary: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --text-disabled: #64748b;
            --border-primary: #334155;
            --border-secondary: #475569;
            --accent-blue: #0ea5e9;
            --accent-blue-hover: #0284c7;
            --accent-green: #06b6d4;
            --accent-green-hover: #0891b2;
            --accent-red: #ef4444;
            --shadow-light: rgba(0, 0, 0, 0.4);
            --shadow-heavy: rgba(0, 0, 0, 0.6);
            --highlight-bg: rgba(14, 165, 233, 0.1);
            --highlight-border: rgba(14, 165, 233, 0.3);
            --theme-name: "Professional";
        }

        [data-theme="vasilev"] {
            /* Evgeniy Vasilev - Architectural Blues & Greens */
            --bg-primary: #0a2140;
            --bg-secondary: #1a3a5f;
            --bg-tertiary: #80a78f;
            --bg-quaternary: #9bb0a6;
            --text-primary: #f5f5f4;
            --text-secondary: #e7e5e4;
            --text-muted: #a8a29e;
            --text-disabled: #78716c;
            --border-primary: #255459;
            --border-secondary: #4c591e;
            --accent-blue: #80a78f;
            --accent-blue-hover: #6b8f7a;
            --accent-green: #255459;
            --accent-green-hover: #1e434a;
            --accent-red: #4c591e;
            --shadow-light: rgba(10, 33, 64, 0.3);
            --shadow-heavy: rgba(10, 33, 64, 0.6);
            --highlight-bg: rgba(128, 167, 143, 0.1);
            --highlight-border: rgba(128, 167, 143, 0.3);
            --theme-name: "Vasilev";
        }

        [data-theme="steel"] {
            /* Steel - Default Dark */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --bg-tertiary: #374151;
            --bg-quaternary: #4b5563;
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --text-disabled: #6b7280;
            --border-primary: #374151;
            --border-secondary: #4b5563;
            --accent-blue: #3b82f6;
            --accent-blue-hover: #2563eb;
            --accent-green: #10b981;
            --accent-green-hover: #059669;
            --accent-red: #ef4444;
            --shadow-light: rgba(0, 0, 0, 0.3);
            --shadow-heavy: rgba(0, 0, 0, 0.5);
            --highlight-bg: rgba(59, 130, 246, 0.1);
            --highlight-border: rgba(59, 130, 246, 0.3);
            --theme-name: "Steel";
        }

        [data-theme="terracotta"] {
            /* Early 4x5 Work - Grayscale */
            --bg-primary: #0D0D0D;
            --bg-secondary: #262626;
            --bg-tertiary: #404040;
            --bg-quaternary: #737373;
            --text-primary: #A6A6A6;
            --text-secondary: #737373;
            --text-muted: #737373;
            --text-disabled: #404040;
            --border-primary: #262626;
            --border-secondary: #404040;
            --accent-blue: #737373;
            --accent-blue-hover: #A6A6A6;
            --accent-green: #A6A6A6;
            --accent-green-hover: #737373;
            --accent-red: #737373;
            --shadow-light: rgba(13, 13, 13, 0.25);
            --shadow-heavy: rgba(13, 13, 13, 0.4);
            --highlight-bg: rgba(115, 115, 115, 0.1);
            --highlight-border: rgba(115, 115, 115, 0.3);
            --theme-name: "Early 4x5";
        }


        [data-theme="soliyev"] {
            /* Soliyev - Frontend Job Portal */
            --bg-primary: #101726;
            --bg-secondary: #1E2940;
            --bg-tertiary: #737373;
            --bg-quaternary: #F2F2F2;
            --text-primary: #F2F2F2;
            --text-secondary: #737373;
            --text-muted: #737373;
            --text-disabled: #1E2940;
            --border-primary: #1E2940;
            --border-secondary: #737373;
            --accent-blue: #737373;
            --accent-blue-hover: #F2F2F2;
            --accent-green: #F2F2F2;
            --accent-green-hover: #737373;
            --accent-red: #737373;
            --shadow-light: rgba(16, 23, 38, 0.3);
            --shadow-heavy: rgba(16, 23, 38, 0.5);
            --highlight-bg: rgba(115, 115, 115, 0.1);
            --highlight-border: rgba(115, 115, 115, 0.3);
            --theme-name: "Soliyev";
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 64px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex: 1;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--text-primary);
            margin: 0;
        }

        /* Theme Selector Dropdown */
        .theme-selector {
            position: relative;
        }

        .theme-toggle {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border-secondary);
            border-radius: 0.375rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-width: 100px;
            font-size: 0.875rem;
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--accent-blue);
        }

        .theme-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px var(--shadow-heavy);
            min-width: 180px;
            z-index: 1000;
            display: none;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .theme-dropdown.visible {
            display: block;
        }

        .theme-option {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.15s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-bottom: 1px solid var(--border-primary);
        }

        .theme-option:last-child {
            border-bottom: none;
        }

        .theme-option:hover {
            background: var(--bg-tertiary);
        }

        .theme-option.active {
            background: var(--accent-blue);
            color: white;
        }

        .theme-preview {
            width: 32px;
            height: 20px;
            border-radius: 0.25rem;
            border: 1px solid var(--border-secondary);
            display: flex;
            overflow: hidden;
        }

        .theme-preview-section {
            flex: 1;
            height: 100%;
        }

        /* Theme previews */
        .theme-preview.steel .theme-preview-section:first-child { background: #1a1a1a; }
        .theme-preview.steel .theme-preview-section:nth-child(2) { background: #2a2a2a; }
        .theme-preview.steel .theme-preview-section:last-child { background: #3b82f6; }

        .theme-preview.terracotta .theme-preview-section:first-child { background: #0D0D0D; }
        .theme-preview.terracotta .theme-preview-section:nth-child(2) { background: #262626; }
        .theme-preview.terracotta .theme-preview-section:last-child { background: #737373; }

        .theme-preview.vasilev .theme-preview-section:first-child { background: #0a2140; }
        .theme-preview.vasilev .theme-preview-section:nth-child(2) { background: #80a78f; }
        .theme-preview.vasilev .theme-preview-section:last-child { background: #255459; }

        .theme-preview.soliyev .theme-preview-section:first-child { background: #101726; }
        .theme-preview.soliyev .theme-preview-section:nth-child(2) { background: #1E2940; }
        .theme-preview.soliyev .theme-preview-section:last-child { background: #737373; }

        .theme-preview.professional .theme-preview-section:first-child { background: #0f172a; }
        .theme-preview.professional .theme-preview-section:nth-child(2) { background: #1e293b; }
        .theme-preview.professional .theme-preview-section:last-child { background: #0ea5e9; }

        .theme-name {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.875rem;
        }

        .theme-option.active .theme-name {
            color: white;
        }

        /* Live Search Container */
        .live-search-container {
            position: relative;
            width: 320px;
        }

        .live-search-input {
            width: 100%;
            background: #ffffff;
            border: 2px solid #cccccc;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: #000000;
            font-size: 0.875rem;
            outline: none;
            transition: all 0.2s;
        }

        .live-search-input:focus {
            border-color: #3b82f6;
            background: #ffffff;
        }

        .live-search-input::placeholder {
            color: #666666;
        }

        /* Live Search Dropdown */
        .live-search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #ffffff;
            border: 1px solid #cccccc;
            border-top: none;
            border-radius: 0 0 0.5rem 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .live-search-dropdown.visible {
            display: block;
        }

        .live-search-item {
            padding: 0.75rem 1rem;
            color: #000000;
            cursor: pointer;
            border-bottom: 1px solid #eeeeee;
            transition: background 0.15s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .live-search-item:hover,
        .live-search-item.highlighted {
            background: #f5f5f5;
        }

        .live-search-item:last-child {
            border-bottom: none;
        }

        .live-search-icon {
            width: 20px;
            height: 20px;
            background: var(--accent-red);
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: white;
            flex-shrink: 0;
        }

        .live-search-text {
            flex: 1;
            min-width: 0;
        }

        .live-search-title {
            font-weight: 500;
            color: #000000;
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .live-search-type {
            font-size: 0.75rem;
            color: #666666;
            margin-top: 0.25rem;
        }

        /* Loading state for live search */
        .live-search-loading {
            padding: 1rem;
            text-align: center;
            color: #666666;
            font-size: 0.875rem;
        }

        .live-search-no-results {
            padding: 1rem;
            text-align: center;
            color: #999999;
            font-size: 0.875rem;
        }

        /* Highlight matching text */
        .highlight {
            background: var(--accent-blue);
            color: white;
            padding: 0.1rem 0.2rem;
            border-radius: 0.2rem;
        }

        .header-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-blue-hover);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border-secondary);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* Main Layout - 20% / 60% / 20% */
        .main-container {
            padding-top: 64px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .top-spacer {
            padding: 1rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .results-counter-row {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .results-counter {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .density-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .density-btn {
            background: transparent;
            border: 1px solid var(--border-secondary);
            border-radius: 0.25rem;
            padding: 0.25rem 0.75rem;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .density-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--accent-blue);
        }

        .density-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .density-divider {
            color: var(--text-disabled);
            font-size: 0.75rem;
        }

        .results-section {
            flex: 1;
            padding: 1rem 2rem;
            padding-bottom: 140px; /* Space for floating search */
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Document Cards */
        .document-card {
            background: #2a2a2a;
            border: 1px solid #374151;
            border-radius: 0.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: stretch;
            min-height: 140px;
        }

        .document-card:hover {
            border-color: #3b82f6;
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            background: #374151;
        }

        /* Horizontal Split Layout - Text Left, Preview Right */
        .document-content-area {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: row;
            align-items: stretch;
        }

        /* Text Section - Left 60% */
        .document-text-section {
            flex: 0 0 60%;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* Preview Section - Right 40% */
        .document-preview-section {
            flex: 0 0 40%;
            position: relative;
            overflow: hidden;
        }

        .document-preview-img {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top right;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        /* Typography - Size Responsive */
        .document-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
            line-height: 1.3;
            word-wrap: break-word;
            max-width: 95%;
        }

        /* Size-specific typography classes */
        .card-tiny .document-title {
            font-size: 0.75rem;
            line-height: 1.2;
        }

        .card-small .document-title {
            font-size: 1.0625rem;
            line-height: 1.3;
        }

        .card-medium .document-title {
            font-size: 1rem;
            line-height: 1.4;
        }

        .card-large .document-title {
            font-size: 1.2rem;
            line-height: 1.4;
        }

        .card-huge .document-title {
            font-size: 1.4rem;
            line-height: 1.5;
        }

        /* PNG Preview removed - full text focus */

        /* Floating Search Bar */
        .floating-search {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 4rem);
            max-width: 600px;
            z-index: 200;
        }

        .search-container {
            background: #2a2a2a;
            border: 2px solid #374151;
            border-radius: 0.5rem;
            padding: 0.75rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .search-container:focus-within {
            border-color: #3b82f6;
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.2);
        }

        .search-input {
            width: 100%;
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            padding: 0.75rem 0;
            outline: none;
            resize: none;
            font-family: inherit;
            line-height: 1.5;
            min-height: 50px;
            max-height: 120px;
            overflow-y: auto;
        }

        .search-input::placeholder {
            color: #9ca3af;
        }

        .search-input::-webkit-scrollbar {
            width: 6px;
        }

        .search-input::-webkit-scrollbar-track {
            background: transparent;
        }

        .search-input::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }

        .button-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            gap: 0.5rem;
        }

        .exact-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 2px solid #4b5563;
            border-radius: 0.5rem;
            color: #d1d5db;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .exact-btn:hover {
            border-color: #3b82f6;
            background: #1e40af;
            color: white;
        }

        .exact-btn.active {
            border-color: #3b82f6;
            background: #3b82f6;
            color: white;
        }

        .submit-btn {
            padding: 0.5rem 1rem;
            background: #10b981;
            border: none;
            border-radius: 0.5rem;
            color: white;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .submit-btn:hover {
            background: #059669;
        }

        .submit-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }

        /* Bottom Spacer */
        .bottom-spacer {
            height: 20vh;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .header-left {
                gap: 1rem;
            }

            .live-search-container {
                width: 200px;
            }

            .header-buttons {
                display: none;
            }

            .top-spacer {
                padding: 1rem 0 0.5rem 0;
            }

            .results-counter-row {
                flex-direction: column;
                gap: 0.5rem;
            }

            .results-counter {
                font-size: 0.75rem;
                text-align: center;
            }

            .density-controls {
                display: none;
            }

            .results-section {
                padding: 0 1rem;
                padding-bottom: 160px;
            }

            .results-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .floating-search {
                width: calc(100% - 2rem);
                bottom: 1rem;
            }

            .search-container {
                padding: 0.75rem;
            }

            .button-row {
                flex-direction: row;
                gap: 0.5rem;
            }

            .exact-btn {
                flex: 0 0 auto;
                min-width: 80px;
            }
            
            .submit-btn {
                flex: 0 0 auto;
                min-width: 80px;
                justify-content: center;
            }

            .document-card {
                flex-direction: row;
                min-height: 80px;
                width: 99%;
                margin: 0 auto;
            }

            .document-content-area {
                padding: 1rem;
                gap: 0.5rem;
            }

            .document-icon {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }

            .document-title {
                font-size: 1rem;
                line-height: 1.3;
                margin-bottom: 0.5rem;
            }

            .document-type {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .live-search-container {
                width: 150px;
            }

            .live-search-input {
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }

            .top-spacer {
                height: 3vh;
            }

            .results-section {
                padding-bottom: 180px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Highlight animation for live search selection */
        @keyframes highlight-flash {
            0% { background: var(--bg-secondary); }
            25% { background: var(--accent-blue); }
            50% { background: var(--accent-blue-hover); }
            75% { background: var(--accent-blue); }
            100% { background: var(--bg-secondary); }
        }

        /* Compact View Modal */
        .compact-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .compact-modal.visible {
            display: flex;
        }

        .compact-window {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 1rem;
            width: 90%;
            max-width: 1000px;
            height: 80%;
            max-height: 600px;
            box-shadow: 0 25px 50px var(--shadow-heavy);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .compact-header {
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-primary);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: between;
            align-items: center;
            gap: 1rem;
        }

        .compact-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .compact-info {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-left: auto;
        }

        .compact-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 1.2rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }

        .compact-close:hover {
            background: var(--bg-quaternary);
            color: var(--text-primary);
        }

        .compact-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .compact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 0.75rem;
        }

        /* Compact Cards - Dense Layout */
        .compact-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-primary);
            border-radius: 0.5rem;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-height: 60px;
        }

        .compact-card:hover {
            border-color: var(--accent-blue);
            background: var(--bg-tertiary);
            transform: translateY(-1px);
        }

        .compact-icon {
            width: 32px;
            height: 32px;
            background: var(--accent-red);
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            flex-shrink: 0;
        }

        .compact-text {
            flex: 1;
            min-width: 0;
        }

        .compact-card-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .compact-card-type {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .compact-preview {
            width: 40px;
            height: 48px;
            background: var(--bg-tertiary);
            border-radius: 0.25rem;
            overflow: hidden;
            flex-shrink: 0;
            border: 1px solid var(--border-secondary);
        }

        .compact-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top;
        }

        /* Compact scrollbar */
        .compact-content::-webkit-scrollbar {
            width: 8px;
        }

        .compact-content::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        .compact-content::-webkit-scrollbar-thumb {
            background: var(--border-secondary);
            border-radius: 4px;
        }

        .compact-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Terms and Conditions Link */
        .terms-link-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .terms-link-container.visible {
            opacity: 1;
        }

        .terms-link {
            background: none;
            border: none;
            color: var(--text-disabled);
            font-size: 0.75rem;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            transition: all 0.3s ease;
            font-family: inherit;
            text-decoration: none;
            border-radius: 0.25rem;
        }

        .terms-link:hover {
            color: var(--text-muted);
            background: rgba(255, 255, 255, 0.05);
        }

        /* Footer Terms Modal */
        .footer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 1001;
            transform: translateY(100vh);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        .footer-modal.visible {
            transform: translateY(0);
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .footer-header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 2rem;
        }

        .footer-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-close:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .footer-text {
            flex: 1;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .footer-text h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .footer-text h4 {
            color: var(--text-primary);
            font-size: 1.1rem;
            margin: 2rem 0 1rem 0;
            font-weight: 500;
        }

        .footer-text p {
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .footer-links {
            margin: 2rem 0;
            text-align: center;
            font-size: 0.875rem;
        }

        .footer-links a {
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: var(--text-primary);
        }

        .footer-copyright {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-primary);
        }

        .footer-copyright p {
            color: var(--text-disabled);
            font-size: 0.875rem;
            margin: 0;
        }

        /* Mobile styles for terms link */
        @media (max-width: 768px) {
            .terms-link-container {
                bottom: 10px;
                right: 10px;
            }

            .terms-link {
                font-size: 0.65rem;
                padding: 0.2rem 0.4rem;
                color: var(--text-disabled);
                opacity: 0.7;
            }

            .footer-content {
                padding: 1.5rem 1rem;
            }

            .footer-text h3 {
                font-size: 1.25rem;
            }

            .footer-close {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .terms-link-container {
                bottom: 8px;
                right: 8px;
            }

            .terms-link {
                font-size: 0.6rem;
                padding: 0.15rem 0.3rem;
                opacity: 0.6;
            }

            .footer-content {
                padding: 1rem 0.75rem;
            }
        }

        /* Mobile compact view */
        @media (max-width: 768px) {
            .compact-modal {
                padding: 1rem;
            }

            .compact-window {
                width: 100%;
                height: 90%;
            }

            .compact-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .compact-card {
                min-height: 50px;
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1><a href="index.html" style="color: inherit; text-decoration: none; cursor: pointer;">Manifest</a></h1>
            
            <!-- Live Search -->
            <div class="live-search-container">
                <input 
                    type="text" 
                    id="liveSearchInput"
                    class="live-search-input" 
                    placeholder="Title Search"
                    autocomplete="off"
                >
                <div id="liveSearchDropdown" class="live-search-dropdown">
                    <!-- Dynamic results will appear here -->
                </div>
            </div>
        </div>
        
        <div class="header-buttons">
            <div class="theme-selector">
                <button id="themeToggle" class="theme-toggle" title="Select theme">
                    <span id="themeIcon">🎨</span>
                    <span id="themeName">Dark</span>
                </button>
                <div id="themeDropdown" class="theme-dropdown">
                    <div class="theme-option active" data-theme="vasilev">
                        <div class="theme-preview vasilev">
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                        </div>
                        <span class="theme-name">Vasilev</span>
                    </div>
                    <div class="theme-option" data-theme="professional">
                        <div class="theme-preview professional">
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                        </div>
                        <span class="theme-name">Professional</span>
                    </div>
                    <div class="theme-option" data-theme="soliyev">
                        <div class="theme-preview soliyev">
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                        </div>
                        <span class="theme-name">Soliyev</span>
                    </div>
                    <div class="theme-option" data-theme="steel">
                        <div class="theme-preview steel">
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                        </div>
                        <span class="theme-name">Steel</span>
                    </div>
                    <div class="theme-option" data-theme="terracotta">
                        <div class="theme-preview terracotta">
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                            <div class="theme-preview-section"></div>
                        </div>
                        <span class="theme-name">Early 4x5</span>
                    </div>
                </div>
            </div>
            <button id="compactViewBtn" class="btn btn-primary">Compact View</button>
            <button class="btn btn-secondary">Sign Out</button>
        </div>
    </header>

    <div class="main-container">
        <!-- Top 20% Spacer with Results Counter -->
        <div class="top-spacer">
            <div class="results-counter-row">
                <div class="results-counter" id="resultsCounter">
                    28 documents found using AI Semantic search
                </div>
                <div class="density-controls">
                    <button id="lessBtn" class="density-btn">Less</button>
                    <span class="density-divider">|</span>
                    <button id="moreBtn" class="density-btn">More</button>
                </div>
            </div>
        </div>

        <!-- Middle 60% - Results Grid -->
        <div class="results-section">
            <div class="results-grid" id="resultsGrid">
                <!-- Cards will be dynamically generated -->
            </div>
        </div>

        <!-- Bottom 20% Spacer -->
        <div class="bottom-spacer"></div>
    </div>

    <!-- Floating Search Bar -->
    <div class="floating-search">
        <div class="search-container">
            <textarea 
                id="searchInput"
                class="search-input" 
                placeholder="Search again..."
            ></textarea>
            
            <div class="button-row">
                <button id="exactBtn" class="exact-btn">
                    Exact
                </button>
                
                <button id="submitBtn" class="submit-btn">
                    <span id="submitText">Search</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Terms and Conditions Link -->
    <div class="terms-link-container" id="termsLinkContainer" style="display: none;">
        <button class="terms-link" id="termsLink">terms and conditions</button>
    </div>

    <!-- Footer Terms Modal -->
    <div class="footer-modal" id="footerModal">
        <div class="footer-content">
            <div class="footer-header">
                <button class="footer-close" id="footerCloseBtn">×</button>
            </div>
            <div class="footer-text">
                <h3>Terms and Conditions</h3>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                
                <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                
                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
                
                <h4>Privacy Policy</h4>
                <p>Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.</p>
                
                <h4>Acceptable Use</h4>
                <p>Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.</p>
                
                <p>Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur.</p>
                
                <div class="footer-links">
                    <a href="#">Privacy Policy</a> • 
                    <a href="#">Terms of Use</a> • 
                    <a href="#">Contact</a> • 
                    <a href="#">Support</a>
                </div>
                
                <div class="footer-copyright">
                    <p>© 2024 Manifest. All rights reserved.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Compact View Modal -->
    <div class="compact-modal" id="compactModal">
        <div class="compact-window">
            <div class="compact-header">
                <h3 class="compact-title">Compact View</h3>
                <span class="compact-info" id="compactInfo">28 documents</span>
                <button class="compact-close" id="compactCloseBtn" title="Close compact view">×</button>
            </div>
            <div class="compact-content">
                <div class="compact-grid" id="compactGrid">
                    <!-- Compact cards will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Generate 100 dummy documents
        function generateDocuments() {
            const titles = [
                "Introduction to Philosophy", "1984", "Sample Invoice", "Annual Budget Report 2024",
                "Team Performance Metrics", "Security Audit Report", "Product Launch Strategy",
                "Customer Satisfaction Survey", "Vendor Compliance Documentation", "Quarterly Financial Review",
                "Employee Onboarding Guide", "Technical Specification v2.0", "Marketing Campaign Analysis",
                "Risk Management Framework", "Operational Procedures Manual", "Financial Statements Q3",
                "Data Privacy Policy", "Software Architecture Guide", "Brand Guidelines 2024",
                "Performance Review Template", "Network Security Protocol", "User Experience Research",
                "Project Management Handbook", "Code Review Standards", "Emergency Response Plan",
                "Training Curriculum Design", "Quality Assurance Manual", "Business Process Documentation",
                "IT Infrastructure Report", "Customer Journey Mapping", "Competitive Analysis Study",
                "Regulatory Compliance Guide", "Investment Portfolio Review", "Sales Training Materials",
                "Product Requirements Document", "System Administration Guide", "Crisis Communication Plan",
                "Market Research Findings", "Internal Audit Report", "Strategic Planning Session",
                "Content Strategy Framework", "API Documentation v3.1", "Change Management Process",
                "Database Schema Design", "User Interface Mockups", "Budget Allocation Spreadsheet",
                "Vendor Agreement Template", "Performance Optimization Guide", "Legal Contract Review",
                "Technical Debt Assessment", "Customer Feedback Analysis", "Project Timeline Overview"
            ];
            
            const types = [
                "Academic Paper", "Classic Literature", "Business Document", "Financial Analysis",
                "HR Analytics", "Compliance Document", "Strategic Planning", "Market Research",
                "Legal Document", "Executive Summary", "Training Manual", "Engineering Document",
                "Performance Report", "Policy Document", "Operations Guide", "Technical Specification",
                "Design Guide", "Process Documentation", "Research Report", "Implementation Plan"
            ];
            
            const documents = [];
            
            for (let i = 1; i <= 100; i++) {
                const titleIndex = (i - 1) % titles.length;
                const typeIndex = Math.floor(Math.random() * types.length);
                const seed = `doc${i}`;
                
                documents.push({
                    id: i,
                    title: i > titles.length ? `${titles[titleIndex]} (${Math.floor(i / titles.length) + 1})` : titles[titleIndex],
                    type: types[typeIndex],
                    imageUrl: `https://picsum.photos/seed/${seed}/400/600`
                });
            }
            
            return documents;
        }

        const documents = generateDocuments();

        // State
        let isExactMode = false;
        let isLoading = false;
        let currentQuery = "philosophy"; // Simulated current search
        
        // Card Size Control State
        let currentSizeIndex = 2; // Start at medium (index 2)
        const cardSizes = [
            { name: 'Tiny', minWidth: '280px' },    // 4-5 cards per row
            { name: 'Small', minWidth: '350px' },   // 3-4 cards per row  
            { name: 'Medium', minWidth: '450px' },  // 2-3 cards per row (current)
            { name: 'Large', minWidth: '600px' },   // 1-2 cards per row
            { name: 'Huge', minWidth: '800px' }     // 1 card per row
        ];

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const exactBtn = document.getElementById('exactBtn');
        const submitBtn = document.getElementById('submitBtn');
        const submitIcon = document.getElementById('submitIcon');
        const submitText = document.getElementById('submitText');
        const resultsGrid = document.getElementById('resultsGrid');
        const resultsCounter = document.getElementById('resultsCounter');
        const liveSearchInput = document.getElementById('liveSearchInput');
        const liveSearchDropdown = document.getElementById('liveSearchDropdown');
        const themeToggle = document.getElementById('themeToggle');
        const themeDropdown = document.getElementById('themeDropdown');
        const themeName = document.getElementById('themeName');
        const compactViewBtn = document.getElementById('compactViewBtn');
        const compactModal = document.getElementById('compactModal');
        const compactCloseBtn = document.getElementById('compactCloseBtn');
        const compactGrid = document.getElementById('compactGrid');
        const compactInfo = document.getElementById('compactInfo');
        
        // Terms and Footer Elements
        const termsLinkContainer = document.getElementById('termsLinkContainer');
        const termsLink = document.getElementById('termsLink');
        const footerModal = document.getElementById('footerModal');
        const footerCloseBtn = document.getElementById('footerCloseBtn');
        
        // Density Control Elements
        const lessBtn = document.getElementById('lessBtn');
        const moreBtn = document.getElementById('moreBtn');

        // Theme Management
        let currentTheme = 'vasilev';

        const themes = {
            steel: { name: 'Steel', icon: '🏢' },
            concrete: { name: 'Concrete', icon: '🏗️' },
            terracotta: { name: 'Terracotta', icon: '🏛️' },
            midnight: { name: 'Midnight', icon: '🌃' },
            sage: { name: 'Sage', icon: '🌿' },
            warm: { name: 'Warm', icon: '☀️' },
            vasilev: { name: 'Vasilev', icon: '🏗️' }
        };

        function setTheme(themeName) {
            currentTheme = themeName;
            
            // Update document theme
            if (themeName === 'steel') {
                document.documentElement.removeAttribute('data-theme');
            } else {
                document.documentElement.setAttribute('data-theme', themeName);
            }
            
            // Update button display
            const theme = themes[themeName];
            document.getElementById('themeIcon').textContent = theme.icon;
            document.getElementById('themeName').textContent = theme.name;
            
            // Update active state in dropdown
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.toggle('active', option.dataset.theme === themeName);
            });
            
            // Save preference
            localStorage.setItem('theme', themeName);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'vasilev';
            setTheme(savedTheme);
        }

        // Theme dropdown functionality
        themeToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            themeDropdown.classList.toggle('visible');
        });

        // Theme selection
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', () => {
                const themeName = option.dataset.theme;
                setTheme(themeName);
                themeDropdown.classList.remove('visible');
            });
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.theme-selector')) {
                themeDropdown.classList.remove('visible');
            }
        });

        // Auto-resize textarea
        function autoResize() {
            searchInput.style.height = 'auto';
            searchInput.style.height = searchInput.scrollHeight + 'px';
        }

        // Update UI based on state
        function updateUI() {
            exactBtn.classList.toggle('active', isExactMode);
            searchInput.placeholder = isExactMode ? 'Exact text search...' : 'AI semantic search...';
            
            const isEmpty = !searchInput.value.trim();
            submitBtn.disabled = isEmpty || isLoading;
            
            if (isLoading) {
                submitText.innerHTML = '<span class="loading"></span> Searching...';
            } else {
                submitText.textContent = 'Search';
            }
        }

        // Create document card
        function createDocumentCard(doc) {
            const card = document.createElement('div');
            card.className = 'document-card';
            card.setAttribute('data-doc-id', doc.id);
            card.onclick = () => openDocument(doc);

            card.innerHTML = `
                <div class="document-content-area">
                    <div class="document-text-section">
                        <div class="document-title">${doc.title}</div>
                    </div>
                    <div class="document-preview-section">
                        <img src="${doc.imageUrl}" alt="${doc.title} preview" class="document-preview-img">
                    </div>
                </div>
            `;

            return card;
        }

        // Handle search submission
        function handleSearch() {
            const query = searchInput.value.trim();
            if (!query || isLoading) return;

            console.log('New search:', {
                query: query,
                mode: isExactMode ? 'exact' : 'semantic'
            });

            isLoading = true;
            updateUI();

            // Simulate API call
            setTimeout(() => {
                isLoading = false;
                currentQuery = query;
                updateUI();
                
                // Scroll to top to show new results
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                console.log('Search completed for:', query);
            }, 800);
        }

        // Card Size Control Functions
        function updateSizeButtons() {
            lessBtn.disabled = currentSizeIndex === 0;
            moreBtn.disabled = currentSizeIndex === cardSizes.length - 1;
            
            // Update button text to show current size
            lessBtn.textContent = currentSizeIndex > 0 ? `← ${cardSizes[currentSizeIndex - 1].name}` : 'Less';
            moreBtn.textContent = currentSizeIndex < cardSizes.length - 1 ? `${cardSizes[currentSizeIndex + 1].name} →` : 'More';
        }

        function changeCardSize(direction) {
            if (direction === 'more' && currentSizeIndex < cardSizes.length - 1) {
                currentSizeIndex++;
            } else if (direction === 'less' && currentSizeIndex > 0) {
                currentSizeIndex--;
            }
            
            applyCardSize();
            updateSizeButtons();
            
            // Save preference
            localStorage.setItem('card-size-preference', currentSizeIndex);
        }

        function applyCardSize() {
            const currentSize = cardSizes[currentSizeIndex];
            const gridElement = document.getElementById('resultsGrid');
            
            // Apply the new grid template
            gridElement.style.gridTemplateColumns = `repeat(auto-fit, minmax(${currentSize.minWidth}, 1fr))`;
            
            // Apply size-specific classes to all cards
            const allCards = document.querySelectorAll('.document-card');
            allCards.forEach(card => {
                // Remove all size classes
                card.classList.remove('card-tiny', 'card-small', 'card-medium', 'card-large', 'card-huge');
                
                // Add current size class
                const sizeClass = `card-${currentSize.name.toLowerCase()}`;
                card.classList.add(sizeClass);
            });
            
            // Update results counter to show current view
            resultsCounter.textContent = `${documents.length} documents • ${currentSize.name} view`;
            
            console.log(`Applied ${currentSize.name} size: ${currentSize.minWidth}`);
        }

        function loadSizePreference() {
            const saved = localStorage.getItem('card-size-preference');
            if (saved !== null) {
                currentSizeIndex = parseInt(saved);
            }
            applyCardSize();
            updateSizeButtons();
        }

        // Render documents (simplified)
        function renderDocuments() {
            resultsGrid.innerHTML = '';
            documents.forEach(doc => {
                resultsGrid.appendChild(createDocumentCard(doc));
            });
            
            // Apply current card size after render
            applyCardSize();
        }

        // Handle document click
        function openDocument(doc) {
            console.log('Opening document:', doc);
            // TODO: Navigate to PDF viewer or open in new tab
            alert(`Opening: ${doc.title}\n\nIn real app: This would open the PDF in split-pane view or new tab`);
        }

        // Live Search Functionality
        let liveSearchTimeout;
        let highlightedIndex = -1;
        let liveSearchResults = [];

        function highlightText(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        function performLiveSearch(query) {
            if (!query || query.length < 2) {
                liveSearchDropdown.classList.remove('visible');
                return;
            }

            // Simulate Elasticsearch search with your documents
            const filteredResults = documents.filter(doc => 
                doc.title.toLowerCase().includes(query.toLowerCase()) ||
                doc.type.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 7); // Show max 7 results

            liveSearchResults = filteredResults;
            renderLiveSearchResults(query);
        }

        function renderLiveSearchResults(query) {
            if (liveSearchResults.length === 0) {
                liveSearchDropdown.innerHTML = `
                    <div class="live-search-no-results">
                        No documents found for "${query}"
                    </div>
                `;
                liveSearchDropdown.classList.add('visible');
                return;
            }

            const resultsHTML = liveSearchResults.map((doc, index) => `
                <div class="live-search-item ${index === highlightedIndex ? 'highlighted' : ''}" 
                     data-index="${index}" 
                     onclick="selectLiveSearchResult(${doc.id})">
                    <div class="live-search-icon">📄</div>
                    <div class="live-search-text">
                        <div class="live-search-title">${highlightText(doc.title, query)}</div>
                        <div class="live-search-type">${highlightText(doc.type, query)}</div>
                    </div>
                </div>
            `).join('');

            liveSearchDropdown.innerHTML = resultsHTML;
            liveSearchDropdown.classList.add('visible');
            highlightedIndex = -1;
        }

        function selectLiveSearchResult(docId) {
            const doc = documents.find(d => d.id === docId);
            if (doc) {
                liveSearchInput.value = doc.title;
                liveSearchDropdown.classList.remove('visible');
                
                // Scroll to the document in the main grid
                const cardElement = document.querySelector(`[data-doc-id="${docId}"]`);
                if (cardElement) {
                    cardElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    cardElement.style.animation = 'highlight-flash 2s ease';
                }
                
                console.log('Live search selected:', doc);
            }
        }

        function handleLiveSearchKeyboard(e) {
            const items = liveSearchDropdown.querySelectorAll('.live-search-item');
            
            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    highlightedIndex = Math.min(highlightedIndex + 1, items.length - 1);
                    updateHighlight();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    highlightedIndex = Math.max(highlightedIndex - 1, -1);
                    updateHighlight();
                    break;
                case 'Enter':
                    e.preventDefault();
                    if (highlightedIndex >= 0 && liveSearchResults[highlightedIndex]) {
                        selectLiveSearchResult(liveSearchResults[highlightedIndex].id);
                    }
                    break;
                case 'Escape':
                    liveSearchDropdown.classList.remove('visible');
                    liveSearchInput.blur();
                    break;
            }
        }

        function updateHighlight() {
            const items = liveSearchDropdown.querySelectorAll('.live-search-item');
            items.forEach((item, index) => {
                item.classList.toggle('highlighted', index === highlightedIndex);
            });
        }

        // Live Search Event Listeners
        liveSearchInput.addEventListener('input', (e) => {
            const query = e.target.value.trim();
            
            clearTimeout(liveSearchTimeout);
            liveSearchTimeout = setTimeout(() => {
                performLiveSearch(query);
            }, 150); // 150ms debounce
        });

        liveSearchInput.addEventListener('keydown', handleLiveSearchKeyboard);

        liveSearchInput.addEventListener('focus', () => {
            if (liveSearchInput.value.trim()) {
                performLiveSearch(liveSearchInput.value.trim());
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.live-search-container')) {
                liveSearchDropdown.classList.remove('visible');
            }
        });

        // Compact View Functions
        function openCompactView() {
            renderCompactCards();
            compactModal.classList.add('visible');
            document.body.style.overflow = 'hidden';
        }

        function closeCompactView() {
            compactModal.classList.remove('visible');
            document.body.style.overflow = 'auto';
        }

        function createCompactCard(doc) {
            const card = document.createElement('div');
            card.className = 'compact-card';
            card.onclick = () => {
                closeCompactView();
                openDocument(doc);
            };

            card.innerHTML = `
                <div class="compact-icon">📄</div>
                <div class="compact-text">
                    <div class="compact-card-title">${doc.title}</div>
                    <div class="compact-card-type">${doc.type.split(' •')[0]}</div>
                </div>
                <div class="compact-preview">
                    <img src="${doc.imageUrl}" alt="${doc.title} preview">
                </div>
            `;

            return card;
        }

        function renderCompactCards() {
            compactGrid.innerHTML = '';
            documents.forEach(doc => {
                compactGrid.appendChild(createCompactCard(doc));
            });
            compactInfo.textContent = `${documents.length} documents`;
        }

        // Compact View Event Listeners
        compactViewBtn.addEventListener('click', openCompactView);
        compactCloseBtn.addEventListener('click', closeCompactView);

        // Close compact view on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && compactModal.classList.contains('visible')) {
                closeCompactView();
            }
        });

        // Close compact view when clicking backdrop
        compactModal.addEventListener('click', (e) => {
            if (e.target === compactModal) {
                closeCompactView();
            }
        });

        // Event Listeners
        searchInput.addEventListener('input', () => {
            autoResize();
            updateUI();
        });

        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSearch();
            }
        });

        exactBtn.addEventListener('click', () => {
            isExactMode = !isExactMode;
            updateUI();
        });

        submitBtn.addEventListener('click', handleSearch);

        // Card Size Control Event Listeners
        lessBtn.addEventListener('click', () => changeCardSize('less'));
        moreBtn.addEventListener('click', () => changeCardSize('more'));

        // Initialize
        loadTheme(); // Load saved theme first
        loadSizePreference(); // Load saved card size
        renderDocuments();
        updateUI();
        searchInput.value = currentQuery;
        autoResize();

        // Handle mobile viewport changes
        function handleViewportChange() {
            if (window.innerHeight < 500) {
                document.body.style.minHeight = window.innerHeight + 'px';
            } else {
                document.body.style.minHeight = '100vh';
            }
        }

        window.addEventListener('resize', handleViewportChange);
        window.addEventListener('orientationchange', () => {
            setTimeout(handleViewportChange, 100);
        });

        // Terms and Conditions Footer Functions
        let hasShownTermsLink = false;

        function checkScrollForTerms() {
            const scrollTop = window.scrollY;
            const documentHeight = document.body.scrollHeight;
            const windowHeight = window.innerHeight;
            
            // Show terms link when user has scrolled to the very bottom
            if (scrollTop + windowHeight >= documentHeight - 10) {
                if (!hasShownTermsLink) {
                    termsLinkContainer.classList.add('visible');
                    termsLinkContainer.style.display = 'block';
                    hasShownTermsLink = true;
                }
            }
        }

        function openFooterModal() {
            footerModal.classList.add('visible');
            document.body.style.overflow = 'hidden';
        }

        function closeFooterModal() {
            footerModal.classList.remove('visible');
            document.body.style.overflow = 'auto';
        }

        // Footer Event Listeners
        termsLink.addEventListener('click', openFooterModal);
        footerCloseBtn.addEventListener('click', closeFooterModal);

        // Close footer on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && footerModal.classList.contains('visible')) {
                closeFooterModal();
            }
        });

        // Scroll detection for terms link
        window.addEventListener('scroll', () => {
            checkScrollForTerms();
            
            // Original infinite scroll detection
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 1000) {
                console.log('Near bottom - would load more documents');
            }
        });
    </script>
</body>
</html>
